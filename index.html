<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minnesota Explained</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: white;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .navbar {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .back-button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            display: none;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .back-button.visible {
            display: block;
        }

        .navbar-content {
            flex: 1;
        }

        .navbar-title {
            font-size: 1.8em;
            font-weight: 700;
            margin: 0 0 5px 0;
        }

        .navbar-subtitle {
            font-size: 1em;
            opacity: 0.9;
            margin: 0;
        }

        .cards-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }

        .card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(42, 82, 152, 0.15);
            border-color: #2a5298;
        }

        .card-title {
            color: #2a5298;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .card-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .card-link {
            color: #2a5298;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .card-link:after {
            content: " →";
        }

        .loading {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e0e0e0;
            border-top: 4px solid #2a5298;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            text-align: center;
            padding: 4rem 2rem;
            color: #d32f2f;
        }

        .error-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .table-view {
            display: none;
        }

        .table-view.active {
            display: block;
        }

        .text-view.active {
            display: block;
        }

        .text-view {
            display: none;
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            background: white;
            overflow: hidden;
            height: calc(100vh - 120px);
            display: flex;
            flex-direction: column;
        }

        .contain {
            max-width: 900px;
            margin: 20px auto;
            display: flex;
            flex-direction: column;
            padding-right:30px;
            padding-left: 30px;
        }

        .text-content {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            line-height: 1.8;
        }

        .text-content h1, .text-content h2, .text-content h3 {
            color: #1e3c72;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .text-content h1 {
            font-size: 2rem;
            border-bottom: 2px solid #2a5298;
            padding-bottom: 0.5rem;
        }

        .text-content h2 {
            font-size: 1.5rem;
        }

        .text-content h3 {
            font-size: 1.2rem;
        }

        .text-content p {
            margin-bottom: 1rem;
        }

        .text-content ul, .text-content ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        .text-content a {
            color: #2a5298;
            text-decoration: none;
        }

        .text-content a:hover {
            text-decoration: underline;
        }

        .text-content code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }

        .text-content pre {
            background: #f5f5f5;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        .text-content blockquote {
            border-left: 4px solid #2a5298;
            padding-left: 1rem;
            margin: 1rem 0;
            color: #666;
            font-style: italic;
        }

        .table-wrapper {
            overflow-y: auto;
            flex: 1;
            padding: 0 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        thead {
            background: #f8f9fa;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #667eea;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
        }

        th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 25px;
        }

        th.sortable:hover {
            background: #e9ecef;
        }

        th.sortable::after {
            content: '⇅';
            position: absolute;
            right: 8px;
            opacity: 0.3;
            font-size: 14px;
        }

        th.sortable.sort-asc::after {
            content: '↑';
            opacity: 1;
            color: #2a5298;
        }

        th.sortable.sort-desc::after {
            content: '↓';
            opacity: 1;
            color: #2a5298;
        }

        th.filterable {
            position: relative;
        }

        .filter-toggle {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: #667eea;
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.2s;
        }

        .filter-toggle:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .filter-toggle.active {
            background: #667eea;
            color: white;
        }

        th.filterable.sortable {
            padding-right: 60px;
        }

        .filter-dropdown {
            display: none;
            margin-top: 5px;
        }

        .filter-dropdown.active {
            display: block;
        }

        .filter-dropdown select {
            width: 100%;
            padding: 4px 8px;
            border: 2px solid #667eea;
            border-radius: 4px;
            font-size: 11px;
            background: white;
            color: #2c3e50;
            cursor: pointer;
            text-transform: none;
            letter-spacing: normal;
        }

        .filter-dropdown select:focus {
            outline: none;
            border-color: #2a5298;
        }

        .filter-active-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            margin-left: 5px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }

        tr:hover {
            background: #f8f9ff;
            transition: background 0.2s ease;
        }

        .department-name {
            font-weight: 600;
            color: #1e3c72;
        }

        .department-name a {
            color: #1e3c72;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .department-name a:hover {
            color: #667eea;
            text-decoration: underline;
        }

        .program-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.25rem;
        }

        .program-link {
            color: #2a5298;
            text-decoration: none;
            font-size: 0.85rem;
        }

        .program-link:hover {
            text-decoration: underline;
        }

        .commissioner-name {
            color: #2c3e50;
        }

        .description {
            color: #555;
            line-height: 1.6;
            font-size: 13px;
        }

        .commissioner-powers {
            color: #444;
            line-height: 1.6;
            font-size: 13px;
        }

        .employees {
            font-weight: 600;
            color: #667eea;
            text-align: center;
        }

        .no-data {
            color: #adb5bd;
            font-style: italic;
        }

        .website-link {
            color: #667eea;
            text-decoration: none;
            font-size: 13px;
            word-break: break-all;
            transition: color 0.2s ease;
        }

        .website-link:hover {
            color: #1e3c72;
            text-decoration: underline;
        }

        .categories {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .category-tag {
            background: #edf2f7;
            color: #4a5568;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        footer {
            text-align: center;
            padding: 15px 20px;
            color: #6c757d;
            font-size: 14px;
            border-top: 1px solid #e9ecef;
            background: white;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .navbar-title {
                font-size: 1.5em;
            }

            .navbar-subtitle {
                font-size: 0.9em;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 10px;
            }
        }

        /* Text View Scoped Styles */
        .textView h1, .textView h2, .textView h3, .textView h4, .textView h5, .textView h6 {
            color: #1e3c72;
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .textView h1 {
            font-size: 2.5rem;
            border-bottom: 3px solid #2a5298;
            padding-bottom: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .textView h2 {
            font-size: 2rem;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 0.5rem;
        }

        .textView h3 {
            font-size: 1.5rem;
            color: #2a5298;
        }

        .textView h4 {
            font-size: 1.25rem;
        }

        .textView h5 {
            font-size: 1.1rem;
        }

        .textView h6 {
            font-size: 1rem;
        }

        .textView p {
            margin-bottom: 1.25rem;
            color: #333;
            font-size: 1rem;
        }

        .textView ul, .textView ol {
            margin-left: 2rem;
            margin-bottom: 1.5rem;
            color: #333;
        }

        .textView li {
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }

        .textView ul ul, .textView ol ul, .textView ul ol, .textView ol ol {
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .textView a {
            color: #2a5298;
            text-decoration: none;
            font-weight: 500;
            border-bottom: 1px solid transparent;
            transition: border-color 0.2s;
        }

        .textView a:hover {
            border-bottom-color: #2a5298;
        }

        .textView strong, .textView b {
            color: #1e3c72;
            font-weight: 600;
        }

        .textView em, .textView i {
            color: #555;
        }

        .textView code {
            background: #f5f5f5;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            color: #d63384;
            border: 1px solid #e0e0e0;
        }

        .textView pre {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 1.5rem;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .textView pre code {
            background: none;
            padding: 0;
            border: none;
            color: #333;
            font-size: 0.875rem;
        }

        .textView blockquote {
            border-left: 4px solid #2a5298;
            padding-left: 1.5rem;
            padding-right: 1rem;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            margin: 1.5rem 0;
            background: #f8f9ff;
            color: #555;
            font-style: italic;
            border-radius: 0 4px 4px 0;
        }

        .textView blockquote p:last-child {
            margin-bottom: 0;
        }

        .textView hr {
            border: none;
            border-top: 2px solid #e0e0e0;
            margin: 2rem 0;
        }

        .textView table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            border: 1px solid #e0e0e0;
        }

        .textView table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #1e3c72;
            border-bottom: 2px solid #2a5298;
        }

        .textView table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .textView table tr:hover {
            background: #f8f9ff;
        }

        .textView img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1.5rem 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .textView .highlight-box {
            background: #fff9e6;
            border-left: 4px solid #ffc107;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 4px 4px 0;
        }

        .textView .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 4px 4px 0;
        }

        .textView .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 4px 4px 0;
        }

        .textView .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 4px 4px 0;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <button class="back-button" id="backButton" onclick="showCards()">← Back</button>
        <div class="navbar-content">
            <h1 class="navbar-title">Minnesota Explained</h1>
            <p class="navbar-subtitle" id="navbarSubtitle">Explore Minnesota State Government</p>
        </div>
    </nav>

    <div id="cardsView" class="cards-container">
        <div id="loadingState" class="loading">
            <div class="loading-spinner"></div>
            <p>Loading data...</p>
        </div>
        <div id="errorState" class="error" style="display: none;">
            <div class="error-title">Failed to Load Data</div>
            <p id="errorMessage"></p>
        </div>
        <div class="cards-grid" id="cardsContainer"></div>
    </div>

    <div id="tableView" class="table-view">
        <div class="container">
            <div class="table-wrapper">
                <table>
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            <footer id="tableFooter"></footer>
        </div>
    </div>

    <div id="textView" class="text-view">
        <div class="contain">
            <div id="textContent"></div>
            <div id="textFooter"></div>
        </div>
    </div>

    <script>
        let artifacts = [];
        let currentArtifactIndex = null;
        let sortColumn = null;
        let sortDirection = 'asc';
        let activeFilters = {}; // { columnIndex: selectedValue }
        let filterDropdownStates = {}; // { columnIndex: true/false }

        // Replace this URL with your GitHub Gist raw URL or other data source
        const DATA_URL = './artifacts.json';

        /* 
         * Artifact structure:
         * {
         *   title: "Artifact Title",
         *   description: "Card description",
         *   subtitle: "Navbar subtitle when viewing",
         *   footer: "Footer text",
         *   type: "array" or "text",
         *   
         *   // For type "array" (table display):
         *   columns: [...],
         *   data: [...]
         *   
         *   // For type "text" (HTML content display):
         *   data: "<h1>Your HTML content here</h1><p>..."
         * }
         * 
         * Column structure for array type:
         * {
         *   header: "Column Name",     // Display name
         *   field: "field_name",       // Data field name
         *   width: "20%",              // Column width
         *   type: "text",              // text, number, link, department-link, program-link, categories, index
         *   sortable: true,            // Enable sorting for this column
         *   filterable: true           // Enable filtering for this column
         * }
         */

        // Fetch data from remote source
        async function loadData() {
            try {
                const response = await fetch(DATA_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                artifacts = await response.json();
                
                // Hide loading, show cards
                document.getElementById('loadingState').style.display = 'none';
                renderCards();
            } catch (error) {
                console.error('Error loading data:', error);
                
                // For demo purposes, load sample data if fetch fails
                loadSampleData();
                
                document.getElementById('loadingState').style.display = 'none';
                renderCards();
            }
        }

        // Sample data for demo purposes (remove this when you have real data)
        function loadSampleData() {
            artifacts = [
                {
                    title: "Minnesota State Departments",
                    description: "Explore state government departments and agencies.",
                    subtitle: "State Departments - Sample Data",
                    footer: "Sample data - Replace with real data source",
                    type: "array",
                    columns: [
                        {
                            "header":"#",
                            "field":"index",
                            "width":"3%",
                            "type":"index"
                        },
                        {
                            "header":"Department",
                            "field":"department",
                            "width":"14%",
                            "type":"department-link",
                            "sortable":true
                        },
                        {
                            "header":"Commissioner",
                            "field":"commissioner",
                            "width":"11%",
                            "type":"text"
                        },
                        {
                            "header":"Commissioner Powers",
                            "field":"commissioner_powers",
                            "width":"20%",
                            "type":"text"
                        },
                        {
                            "header":"Employees",
                            "field":"employees",
                            "width":"8%",
                            "type":"number"
                        },
                        {
                            "header":"Website",
                            "field":"url",
                            "width":"14%",
                            "type":"link"
                        }
                    ],
                    data: [
                        {
                            "department":"Department of Administration",
                            "commissioner":"Tamar Gronvall",
                            "description":"The department manages and administers centralized operations of state agencies, including procurement of goods and services, travel and fleet services, building construction and maintenance, real estate leasing and management, and facilities and maintenance services. Provides a broad range of business management, administrative and professional services and resources to state agencies, local governments and the public.",
                            "commissioner_powers":"Manages and administers centralized operations of state agencies; procurement of goods and services; building construction and maintenance; real estate leasing and management; facilities and maintenance services; oversight of state buildings and properties; administers grants management and data practices; enforces data practices act and open meeting law.",
                            "employees":524,
                            "url":"https://mn.gov/admin"
                        },
                        {
                            "department":"Department of Agriculture",
                            "commissioner":"Thom Petersen",
                            "description":"The department encourages and promotes agricultural industries, assists in the marketing of farm products, and exercises regulatory powers to ensure the continued high quality of Minnesota agricultural production. Enhances Minnesotans' quality of life by ensuring the integrity of the food supply, the health of the environment, and the strength of the agricultural economy.",
                            "commissioner_powers":"Encourages and promotes agricultural industries; assists in marketing of farm products; exercises regulatory powers to ensure high quality of agricultural production; inspects food manufacturers, dairy farms, feed mills; regulates pesticides and fertilizers; licenses applicators; protects crops and plant species from pests and diseases; certifies nursery stock and seed industries.",
                            "employees":548,
                            "url":"https://mda.state.mn.us"
                        },
                    ]
                },
                {
                    title: "About Minnesota Government",
                    description: "Learn about the structure and history of Minnesota's government.",
                    subtitle: "About Minnesota Government",
                    footer: "Sample text content - Last updated January 2026",
                    type: "text",
                    data: `
                        <h1>Minnesota State Government</h1>
                        
                        <p>Minnesota has a rich tradition of government service and public administration. The state's government structure is designed to serve its diverse population efficiently and effectively.</p>
                        
                        <h2>Three Branches of Government</h2>
                        
                        <h3>Executive Branch</h3>
                        <p>The executive branch is led by the Governor and includes various state agencies and departments that carry out state laws and provide services to Minnesotans.</p>
                        <ul>
                            <li>Governor's Office</li>
                            <li>Lieutenant Governor</li>
                            <li>State Agencies and Departments</li>
                        </ul>
                        
                        <h3>Legislative Branch</h3>
                        <p>The Minnesota Legislature consists of two bodies:</p>
                        <ul>
                            <li><strong>Senate:</strong> 67 members serving 4-year terms</li>
                            <li><strong>House of Representatives:</strong> 134 members serving 2-year terms</li>
                        </ul>
                        
                        <h3>Judicial Branch</h3>
                        <p>Minnesota's court system ensures justice and interprets laws. It includes:</p>
                        <ul>
                            <li>Minnesota Supreme Court</li>
                            <li>Court of Appeals</li>
                            <li>District Courts</li>
                        </ul>
                        
                        <h2>Key Facts</h2>
                        <blockquote>
                            Minnesota became the 32nd state to join the Union on May 11, 1858.
                        </blockquote>
                        
                        <p>The state capital is Saint Paul, while Minneapolis is the largest city. Together, they form the "Twin Cities" metropolitan area.</p>
                        
                        <h2>Government Services</h2>
                        <p>Minnesota state government provides numerous services including:</p>
                        <ol>
                            <li>Education and early childhood programs</li>
                            <li>Healthcare services and public health</li>
                            <li>Transportation infrastructure</li>
                            <li>Environmental protection</li>
                            <li>Public safety and corrections</li>
                            <li>Economic development and workforce programs</li>
                        </ol>
                        
                        <p>For more information, visit the official Minnesota state website at <a href="https://mn.gov" target="_blank">mn.gov</a>.</p>
                    `
                },
                {
                    title: "DCYF Programs",
                    description: "Department of Children, Youth and Family programs.",
                    subtitle: "DCYF Programs - Sample Data",
                    footer: "Sample data - Replace with real data source",
                    type: "array",
                    columns: [
                        {
                            "header":"Program",
                            "field":"title",
                            "width":"25%",
                            "type":"program-link",
                            "sortable":true
                        },
                        {
                            "header":"Description",
                            "field":"description",
                            "width":"50%",
                            "type":"text"
                        },
                        {
                            "header":"Categories",
                            "field":"categories",
                            "width":"25%",
                            "type":"categories",
                            "filterable":true
                        }
                    ],
                    data: [
                        {
                            "title":"Whole Family Approach",
                            "description":"In order to better coordinate and resource the systems that service children, youth, and families, the Department of Children, Youth, and Families is taking a Whole Family Approach to our work. A Whole Family Approach is an approach to practice, program and policy decision making that recognizes and addresses the needs of children and the adults in their lives simultaneously. This approach recognizes that families come in all different shapes and sizes and that families define themselves.",
                            "link":"https://dcyf.mn.gov/whole-family-approach",
                            "categories":[
                                "Child Care and Early Learning",
                                "Family Resources",
                                "Income Support"
                            ]
                        },
                        {
                            "title":"Child Care Access Grants",
                            "description":"Child Care Access Grantees can help families experiencing homelessness or housing instability apply for and maintain their child care assistance.",
                            "link":"https://dcyf.mn.gov/programs-directory/child-care-access-grants",
                            "categories":[
                                "Child Care and Early Learning"
                            ]
                        },
                    ]
                },
                {
                    "title":"Progressive Legislative Ideas",
                    "description":"Legislative bills that could redistribute wealth in Minnesota.",
                    "subtitle":"",
                    "footer":"",
                    "columns":[
                        {
                            "header":"#",
                            "field":"index",
                            "width":"3%",
                            "type":"index"
                        },
                        {
                            "header":"Bill Title",
                            "field":"title",
                            "width":"10%",
                            "type":"title",
                            "sortable":true
                        },
                        {
                            "header":"Description",
                            "field":"description",
                            "width":"20%",
                            "type":"text"
                        },
                        {
                            "header":"Text",
                            "field":"text",
                            "width":"50%",
                            "type":"text"
                        },
                        {
                            "header":"Categories",
                            "field":"categories",
                            "width":"10%",
                            "type":"categories",
                            "filterable":true
                        }
                    ],
                    "data":[
                      {
                        "title": "Minnesota Basic Income Grant Program Act",
                        "categories": ["Direct Assistance", "Anti-Poverty", "Human Services"],
                        "description": "Establishes a statewide competitive grant program to provide monthly cash payments of $350 to $1,200 to low-income residents to disrupt poverty and build community wealth.",
                        "text": "A bill for an act relating to human services; establishing a Minnesota basic income grant program; requiring a report; appropriating money. BE IT ENACTED BY THE LEGISLATURE OF THE STATE OF MINNESOTA: Section 1. MINNESOTA BASIC INCOME GRANT PROGRAM. Subdivision 1. Establishment. The commissioner of human services must establish a competitive grant program for local government entities, Minnesota's Tribal Nations, or nonprofit organizations to provide regular cash payments to eligible recipients in order to disrupt poverty, build wealth, advance equity, and support a recipient's basic needs. Subd. 4. Use of grant money. Grantees must use grant money to: (1) design and implement a basic income grant program; (2) provide a monthly payment between $350 to $1,200 to eligible recipients for a period of 12 to 24 months; and (3) collect data on the economic status of recipients. Subd. 5. Eligible recipients. Persons eligible to receive monthly payments must be receiving public benefits or have a household income less than or equal to 300 percent of the federal poverty guidelines."
                      },
                      {
                        "title": "Corporate Franchise Tax Rate Contingency Act",
                        "categories": ["Corporate Taxation", "Fiscal Policy", "Revenue Neutrality"],
                        "description": "Adjusts the state corporate tax rate upward if federal corporate taxes are reduced, ensuring that large corporations continue to contribute a fair share to the state's general fund.",
                        "text": "A bill for an act relating to taxation; corporate franchise; providing for a contingent increase in the tax rate; amending Minnesota Statutes 2024, section 290.06, subdivision 1. BE IT ENACTED BY THE LEGISLATURE OF THE STATE OF MINNESOTA: Section 1. Minnesota Statutes 2024, section 290.06, subdivision 1, is amended to read: Subdivision 1. Computation, corporations. (a) For taxable years beginning after December 31, 2024, the franchise tax imposed upon corporations shall be computed by applying to their taxable income the rate greater of: (1) 9.8 percent; or (2) the rate calculated under paragraph (c). (b) Pursuant to enactment of federal legislation decreasing the corporate franchise tax rate, the commissioner must calculate the percentage decrease and increase Minnesota's tax rate by a corresponding percentage, rounded to the nearest twentieth of a percent."
                      },
                      {
                        "title": "Expanded Corporate Tax Compliance & Enforcement Initiative",
                        "categories": ["Enforcement & Oversight", "Corporate Reform", "Government Operations"],
                        "description": "Allocates funding to the Department of Revenue to specifically target and collect unpaid tax liabilities from corporations with over $25 million in Minnesota sales.",
                        "text": "A bill for an act relating to taxation; appropriating money for an expanded corporate tax compliance initiative. BE IT ENACTED BY THE LEGISLATURE OF THE STATE OF MINNESOTA: Section 1. APPROPRIATION; EXPANDED CORPORATE TAX COMPLIANCE INITIATIVE. Subdivision 1. Appropriation. $10,000,000 in fiscal year 2026 is appropriated from the general fund to the commissioner of revenue to develop and implement an expanded corporate tax compliance initiative. Subd. 2. Requirements. The initiative must prioritize compliance and enforcement activities among corporations reporting $25,000,000 or more in Minnesota sales or gross receipts for a taxable year to ensure the identification and collection of tax liabilities from corporations that currently do not accurately report taxable income."
                      },
                      {
                        "title": "Net Investment Income Tax Act",
                        "categories": ["Wealth & Capital Taxation", "Individual Income Tax", "Equity"],
                        "description": "Imposes a 1% tax on net investment income exceeding $1 million for individuals and trusts, redirecting capital gains and dividend wealth into the state treasury.",
                        "text": "A bill for an act relating to taxation; individual income; imposing a tax on net investment income. BE IT ENACTED BY THE LEGISLATURE OF THE STATE OF MINNESOTA: Section 1. NET INVESTMENT INCOME TAX. (a) A tax is imposed on the net investment income of individuals, estates, and trusts for the taxable year. (b) The tax is equal to one percent of the taxpayer's net investment income in excess of $1,000,000. (c) 'Net investment income' has the meaning given in section 1411(c) of the Internal Revenue Code. (d) This section is effective for taxable years beginning after December 31, 2023."
                      }
                    ]
                },
                {
                    "title":"City Council Member Katie Cashman",
                    "description":"A dashboard of the council member's work.",
                    "subtitle":"About Minnesota Government",
                    "footer":"",
                    "type":"link",
                    "link":"/cashman.html",
                },

            ];
        }

        function renderCards() {
            const container = document.getElementById('cardsContainer');
            container.innerHTML = '';
            
            artifacts.forEach((artifact, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = () => showTable(index);
                
                card.innerHTML = `
                    <h2 class="card-title">${artifact.title}</h2>
                    <p class="card-description">${artifact.description}</p>
                    <span class="card-link">View Details</span>
                `;
                
                container.appendChild(card);
            });
        }

        async function showTable(index) {
            const artifact = artifacts[index];
            currentArtifactIndex = index;
            sortColumn = null;
            sortDirection = 'asc';
            activeFilters = {};
            filterDropdownStates = {};
        
            if(artifact.type !== 'link'){
                document.getElementById('navbarSubtitle').textContent = artifact.subtitle;
                document.getElementById('backButton').classList.add('visible');
                document.getElementById('cardsView').style.display = 'none';
            }
            
            // Check artifact type and render accordingly
            if(artifact.type === 'link'){
                window.open(artifact.link, '_blank').focus();
            } else if (artifact.type === 'text') {
                var response = await fetch(artifact.src);
                artifact.data = await response.text();
                document.getElementById('tableView').classList.remove('active');
                document.getElementById('textView').classList.add('active');
                renderTextContent(artifact);
            } else {
                // Default to array/table type
                document.getElementById('textView').classList.remove('active');
                document.getElementById('tableView').classList.add('active');
                renderDynamicTable(artifact);
            }
        }

        function showCards() {
            document.getElementById('cardsView').style.display = 'block';
            document.getElementById('tableView').classList.remove('active');
            document.getElementById('textView').classList.remove('active');
            document.getElementById('backButton').classList.remove('visible');
            document.getElementById('navbarSubtitle').textContent = 'Explore Minnesota State Government';
        }

        function renderDynamicTable(artifact) {
            const tableHead = document.getElementById('tableHead');
            const tableBody = document.getElementById('tableBody');
            const tableFooter = document.getElementById('tableFooter');
            
            // Filter data based on active filters
            let displayData = [...artifact.data];
            Object.keys(activeFilters).forEach(colIndex => {
                const filterValue = activeFilters[colIndex];
                if (filterValue !== '') {
                    const column = artifact.columns[colIndex];
                    displayData = displayData.filter(row => {
                        const value = row[column.field];
                        if (column.type === 'categories') {
                            return value && value.includes(filterValue);
                        }
                        return String(value || '').toLowerCase() === filterValue.toLowerCase();
                    });
                }
            });
            
            // Sort data if a sort column is selected
            if (sortColumn !== null) {
                displayData = sortData(displayData, artifact.columns[sortColumn], sortDirection);
            }
            const isMobile = navigator.userAgentData.mobile;
            
            // Render header
            const headerRow = document.createElement('tr');

            if(isMobile){
                const th = document.createElement('th');
                th.textContent = artifact.title;
                headerRow.appendChild(th);
            } else {

                artifact.columns.forEach((col, colIndex) => {
                    const th = document.createElement('th');
                    if (col.width) th.style.width = col.width;
                    
                    // Create header content wrapper
                    const headerContent = document.createElement('div');
                    headerContent.style.position = 'relative';
                    
                    // Add header text
                    const headerText = document.createElement('span');
                    headerText.textContent = col.header;
                    headerContent.appendChild(headerText);
                    
                    // Add active filter indicator
                    if (activeFilters[colIndex] && activeFilters[colIndex] !== '') {
                        const indicator = document.createElement('span');
                        indicator.className = 'filter-active-indicator';
                        headerContent.appendChild(indicator);
                    }
                    
                    // Add filter toggle button if filterable
                    if (col.filterable) {
                        th.classList.add('filterable');
                        const toggleBtn = document.createElement('span');
                        toggleBtn.className = 'filter-toggle';
                        toggleBtn.textContent = 'Filter';
                        toggleBtn.title = 'Toggle filter';
                        if (filterDropdownStates[colIndex]) {
                            toggleBtn.classList.add('active');
                        }
                        toggleBtn.onclick = (e) => {
                            e.stopPropagation();
                            toggleFilter(colIndex);
                        };
                        headerContent.appendChild(toggleBtn);
                        
                        // Add filter dropdown
                        const filterDiv = document.createElement('div');
                        filterDiv.className = 'filter-dropdown';
                        if (filterDropdownStates[colIndex]) {
                            filterDiv.classList.add('active');
                        }
                        
                        const select = document.createElement('select');
                        select.onchange = (e) => handleFilterChange(colIndex, e.target.value);
                        
                        // Get unique values for this column
                        const uniqueValues = getUniqueValues(artifact.data, col);
                        
                        // Add "All" option
                        const allOption = document.createElement('option');
                        allOption.value = '';
                        allOption.textContent = '-- All --';
                        select.appendChild(allOption);
                        
                        // Add unique values as options
                        uniqueValues.forEach(value => {
                            const option = document.createElement('option');
                            option.value = value;
                            option.textContent = value;
                            if (activeFilters[colIndex] === value) {
                                option.selected = true;
                            }
                            select.appendChild(option);
                        });
                        
                        filterDiv.appendChild(select);
                        headerContent.appendChild(filterDiv);
                    }
                    
                    th.appendChild(headerContent);
                    
                    // Add sortable class and click handler if sortable
                    if (col.sortable) {
                        th.classList.add('sortable');
                        if (sortColumn === colIndex) {
                            th.classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
                        }
                        th.onclick = () => handleSort(colIndex);
                    }
                    
                    headerRow.appendChild(th);
                    
                });
            }
            tableHead.innerHTML = '';
            tableHead.appendChild(headerRow);
            
            // Render body
            tableBody.innerHTML = '';


            displayData.forEach((row, rowIndex) => {
                const tr = document.createElement('tr');
                
                if(isMobile){
                    var td = document.createElement('td');
                    tr.appendChild(td);
                }
                artifact.columns.forEach(col => {

                    if(isMobile){
                        const div = document.createElement('div');
                        const value = col.type === 'index' ? rowIndex + 1 : row[col.field];
                        
                        switch(col.type) {
                            case 'index':
                                div.className = 'employees';
                                div.textContent = rowIndex + 1;
                                break;
                            case 'department-link':
                                div.className = 'department-name';
                                div.innerHTML = `<a href="${row.url}" target="_blank" rel="noopener noreferrer">${value}</a>`;
                                break;
                            case 'program-link':
                                div.innerHTML = `<div class="program-title">${value}</div><a href="${row.link}" target="_blank" class="program-link">View Details →</a>`;
                                break;
                            case 'title':
                                div.innerHTML = `<div class="program-title">${value}</div>`;
                                break;
                            case 'link':
                                div.innerHTML = `<a href="${value}" target="_blank" rel="noopener noreferrer" class="website-link">${value}</a>`;
                                break;
                            default:
                                if (col.field === 'description') td.className = 'description';
                                else if (col.field === 'commissioner_powers') td.className = 'commissioner-powers';
                                else if (col.field === 'commissioner') td.className = 'commissioner-name';
                                div.innerHTML = `<b>${col.header}</b> - ` +  value || '';
                                break;
                        }
                        
                        td.appendChild(div);
                    } else {

                        const td = document.createElement('td');
                        const value = col.type === 'index' ? rowIndex + 1 : row[col.field];
                        
                        switch(col.type) {
                            case 'index':
                                td.className = 'employees';
                                td.textContent = rowIndex + 1;
                                break;
                            case 'department-link':
                                td.className = 'department-name';
                                td.innerHTML = `<a href="${row.url}" target="_blank" rel="noopener noreferrer">${value}</a>`;
                                break;
                            case 'program-link':
                                td.innerHTML = `<div class="program-title">${value}</div><a href="${row.link}" target="_blank" class="program-link">View Details →</a>`;
                                break;
                            case 'title':
                                td.innerHTML = `<div class="program-title">${value}</div>`;
                                break;
                            case 'link':
                                td.innerHTML = `<a href="${value}" target="_blank" rel="noopener noreferrer" class="website-link">${value}</a>`;
                                break;
                            case 'number':
                                td.className = 'employees';
                                td.innerHTML = value !== null ? value.toLocaleString() : '<span class="no-data">N/A</span>';
                                break;
                            case 'categories':
                                td.innerHTML = `<div class="categories">${value.map(cat => `<span class="category-tag">${cat}</span>`).join('')}</div>`;
                                break;
                            case 'text':
                            default:
                                if (col.field === 'description') td.className = 'description';
                                else if (col.field === 'commissioner_powers') td.className = 'commissioner-powers';
                                else if (col.field === 'commissioner') td.className = 'commissioner-name';
                                td.textContent = value || '';
                                break;
                        }
                        
                        tr.appendChild(td);
                    }
                });
                
                tableBody.appendChild(tr);
            });
            
            const filterCount = Object.values(activeFilters).filter(v => v !== '').length;
            const footerText = artifact.footer + (filterCount > 0 ? ` | ${displayData.length} of ${artifact.data.length} rows shown` : '');
            tableFooter.textContent = footerText;
        }

        function handleSort(colIndex) {
            if (sortColumn === colIndex) {
                // Toggle sort direction
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                // New column, default to ascending
                sortColumn = colIndex;
                sortDirection = 'asc';
            }
            
            renderDynamicTable(artifacts[currentArtifactIndex]);
        }

        function toggleFilter(colIndex) {
            filterDropdownStates[colIndex] = !filterDropdownStates[colIndex];
            renderDynamicTable(artifacts[currentArtifactIndex]);
        }

        function handleFilterChange(colIndex, value) {
            activeFilters[colIndex] = value;
            renderDynamicTable(artifacts[currentArtifactIndex]);
        }

        function getUniqueValues(data, column) {
            const values = new Set();
            
            data.forEach(row => {
                const value = row[column.field];
                if (column.type === 'categories' && Array.isArray(value)) {
                    // For categories, add each category separately
                    value.forEach(cat => values.add(cat));
                } else if (value !== null && value !== undefined && value !== '') {
                    values.add(String(value));
                }
            });
            
            return Array.from(values).sort();
        }

        function renderTextContent(artifact) {
            const textContent = document.getElementById('textContent');
            const textFooter = document.getElementById('textFooter');
            
            // Render HTML content
            textContent.innerHTML = artifact.data;
            textFooter.textContent = artifact.footer || '';
        }

        function sortData(data, column, direction) {
            return data.sort((a, b) => {
                let aVal = a[column.field];
                let bVal = b[column.field];
                
                // Handle null values
                if (aVal === null || aVal === undefined) return direction === 'asc' ? 1 : -1;
                if (bVal === null || bVal === undefined) return direction === 'asc' ? -1 : 1;
                
                // Sort based on column type
                if (column.type === 'number') {
                    aVal = Number(aVal);
                    bVal = Number(bVal);
                } else if (column.type === 'categories') {
                    // Sort by first category
                    aVal = aVal[0] || '';
                    bVal = bVal[0] || '';
                } else {
                    // Text sorting (case insensitive)
                    aVal = String(aVal).toLowerCase();
                    bVal = String(bVal).toLowerCase();
                }
                
                if (aVal < bVal) return direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return direction === 'asc' ? 1 : -1;
                return 0;
            });
        }

        // Load data when page loads
        loadData();
    </script>
</body>
</html>